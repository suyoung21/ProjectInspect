<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <title>测试</title>
    </head>
    <body>
        <div id="status0">
            <a href="javascript:;" id="start">开始</a>
        </div>
        <div id="status1" style="display:none;">
            <span id="time"></span>
            <a href="javascript:;" id="stop">停止</a>
        </div>
        <div id="status2" style="display:none;">
            <span id="play_time"></span>
            <a href="javascript:;" id="play">播放</a>
            <a href="javascript:;" id="restart">重新录制</a>
            <a href="javascript:;" id="upload">上传</a>
        </div>
        <div>
            <a href="javascript:;" id="choose">选择图片</a>
        </div>
        <div>
            <a href="javascript:;" id="take">拍照</a>
        </div>
        <div id="log"></div>
        <script>
            var gl = gl || {};
            var _log = function(res){
                if(typeof res !== 'string'){
                    res = JSON.stringify(res);
                }
                $('log').innerHTML += '<p>'+res+'</p>';
            }
            // 所有res都为json
            // res.code  状态码，1为正常，其他为异常
            // res.message 状态描述
            // res.data 为其他数据
            // 比如stopRecordCallback的时候返回{time:11}表示录制了11秒
            // 比如上传完成后，返回上传后服务器返回的数据
            gl.stopRecordCallback = function(res){
                var _res = res;
                if(typeof _res === 'string'){
                    _res = JSON.parse(_res);
                }
                if(_res.code == 1){
                    $('status0').style.display = 'none';
                    $('status1').style.display = 'none';
                    $('status2').style.display = 'block';
                }
                _log(res);
            }
            gl.startRecordCallback = function(res,time){
                var _res = res;
                if(typeof _res === 'string'){
                    _res = JSON.parse(_res);
                }
                if(time === undefined){
                    if(_res.code == 1){
                        $('status0').style.display = 'none';
                        $('status1').style.display = 'block';
                        $('status2').style.display = 'none';
                    }
                    _log(res);
                }else{
                    $('time').innerHTML = time;
                }
            }
            gl.uploadRecordCallback = function(res){
                var _res = res;
                if(typeof _res === 'string'){
                    _res = JSON.parse(_res);
                }
                _log(res);
            }
            gl.playRecordCallback = function(res,time){
                var _res = res;
                if(typeof _res === 'string'){
                    _res = JSON.parse(_res);
                }
                if(time === undefined){
                    $('play_time').innerHTML = time;
                }
                _log(res);
            }
            
            gl.choosePhotoCallback = function(res){
                    alert("choosePhotoCallback");
                var _res = res;
                if(typeof _res === 'string'){
                    _res = JSON.parse(_res);
                }
                _log(res);

            }
            
            gl.takePhotoCallback = function(res){
                   alert("takePhotoCallback");
                var _res = res;
                if(typeof _res === 'string'){
                    _res = JSON.parse(_res);
                }
                _log(res);
            }
            var $ = function(id){
                return document.getElementById(id);
            }
            $('start').onclick = function(){
                gl.startRecord(60, 'gl.stopRecordCallback' , 'gl.startRecordCallback')
            }
            $('stop').onclick = function(){
                gl.stopRecord('gl.stopRecordCallback');
            }
            $('play').onclick = function(){
                gl.playRecord('gl.playRecordCallback’');
            }
            $('restart').onclick = function(){
                $('status0').style.display = 'block';
                $('status1').style.display = 'none';
                $('status2').style.display = 'none';
            }
            $('upload').onclick = function(){
                var params = {
                    a : 1,
                    b : 2
                }
                var str = JSON.stringify(params);
                gl.uploadRecord(str,'gl.uploadRecordCallback’');
            }
            $('choose').onclick = function(){
                var params = {
                    a : 1,
                    b : 2
                }
                var str = JSON.stringify(params);
                gl.choosePhoto(str,'gl.choosePhotoCallback')
            }
            $('take').onclick = function(){
                var params = {
                    a : 1,
                    b : 2
                }
                var str = JSON.stringify(params);
                gl.takePhoto(str,'gl.takePhotoCallback’')
            }
        </script>
    </body>
</html>